<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="WorkoutTracker.Views.HistoryPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="History">

    <VerticalStackLayout Padding="16" Spacing="12">

        <Label Text="Recent Sessions" FontAttributes="Bold" />

        <!-- Pull to refresh -->
        <RefreshView IsRefreshing="{Binding IsBusy}" Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding RecentSessions}"
                      SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="12"
                  ColumnDefinitions="*,Auto"
                  ColumnSpacing="12">

                            <!-- Tap row to navigate -->
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnItemTapped" />
                            </Grid.GestureRecognizers>

                            <VerticalStackLayout>
                                <Label Text="{Binding Title}" FontAttributes="Bold" />
                                <Label Text="{Binding Subtitle}" FontSize="12" Opacity="0.7" />
                            </VerticalStackLayout>

                            <Label Grid.Column="1"
                     Text="â€º"
                     FontSize="24"
                     Opacity="0.4"
                     VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <BoxView HeightRequest="1" Opacity="0.2" />

        <Label Text="Sets" FontAttributes="Bold" />

        <!-- If you use a details preview under the list, keep this; otherwise you can remove -->
        <CollectionView ItemsSource="{Binding SelectedSessionSets}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="8" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
                        <Label Text="{Binding Time, StringFormat='{}{0:HH:mm}'}" />
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="{Binding ExerciseName}" />
                            <Label Text="{Binding Summary}" FontSize="12" Opacity="0.7" />
                        </VerticalStackLayout>
                        <Label Grid.Column="2" Text="{Binding Weight, StringFormat='{0:0.##} kg'}" />
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
